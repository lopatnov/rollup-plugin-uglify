{"version":3,"file":"plugin.umd.js","sources":["../src/plugin.ts"],"sourcesContent":["import {\r\n  Plugin,\r\n  NormalizedOutputOptions,\r\n  RenderedChunk,\r\n  TransformPluginContext,\r\n} from \"rollup\";\r\nimport { minify, MinifyOptions } from \"terser\";\r\nimport { createFilter } from \"@rollup/pluginutils\";\r\n\r\nexport interface IUglifyOptions extends MinifyOptions {\r\n  include?: string | RegExp;\r\n  exclude?: string | RegExp;\r\n  /** @default \"renderChunk\" */\r\n  hook?: \"renderChunk\" | \"transform\";\r\n}\r\n\r\nfunction uglify(options: IUglifyOptions = {}): Plugin {\r\n  const filter = createFilter(options.include, options.exclude);\r\n  const hook = options.hook || \"transform\";\r\n  delete options.include;\r\n  delete options.exclude;\r\n  delete options.hook;\r\n\r\n  async function minifyCode(code: string, defaultSourceMap: boolean) {\r\n    const minifyOptions = {\r\n      ...options,\r\n      sourceMap:\r\n        options.sourceMap !== undefined ? options.sourceMap : defaultSourceMap,\r\n    };\r\n\r\n    const result = await minify(code, minifyOptions);\r\n\r\n    if (!result || !result.code) {\r\n      throw new Error(\"Minification failed: no result\");\r\n    }\r\n\r\n    return {\r\n      code: result.code,\r\n      map: result.map as any,\r\n    };\r\n  }\r\n\r\n  const plugin: Plugin = {\r\n    name: \"uglify\",\r\n  };\r\n\r\n  if (hook === \"transform\") {\r\n    plugin.transform = async function (\r\n      this: TransformPluginContext,\r\n      code: string,\r\n      id: string,\r\n    ) {\r\n      if (!filter(id)) {\r\n        return null;\r\n      }\r\n      return minifyCode(code, true);\r\n    };\r\n  } else {\r\n    plugin.renderChunk = async function (\r\n      code: string,\r\n      chunk: RenderedChunk,\r\n      outputOptions: NormalizedOutputOptions,\r\n    ) {\r\n      if (!filter(chunk.fileName)) {\r\n        return null;\r\n      }\r\n      return minifyCode(code, !!outputOptions.sourcemap);\r\n    };\r\n  }\r\n\r\n  return plugin;\r\n}\r\n\r\nexport { uglify };\r\nexport default uglify;\r\n"],"names":["createFilter","minify"],"mappings":";;;;;;IAgBA,SAAS,MAAM,CAAC,OAAA,GAA0B,EAAE,EAAA;IAC1C,IAAA,MAAM,MAAM,GAAGA,wBAAY,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC;IAC7D,IAAA,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,IAAI,WAAW;QACxC,OAAO,OAAO,CAAC,OAAO;QACtB,OAAO,OAAO,CAAC,OAAO;QACtB,OAAO,OAAO,CAAC,IAAI;IAEnB,IAAA,eAAe,UAAU,CAAC,IAAY,EAAE,gBAAyB,EAAA;IAC/D,QAAA,MAAM,aAAa,GAAG;IACpB,YAAA,GAAG,OAAO;IACV,YAAA,SAAS,EACP,OAAO,CAAC,SAAS,KAAK,SAAS,GAAG,OAAO,CAAC,SAAS,GAAG,gBAAgB;aACzE;YAED,MAAM,MAAM,GAAG,MAAMC,aAAM,CAAC,IAAI,EAAE,aAAa,CAAC;YAEhD,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;IAC3B,YAAA,MAAM,IAAI,KAAK,CAAC,gCAAgC,CAAC;YACnD;YAEA,OAAO;gBACL,IAAI,EAAE,MAAM,CAAC,IAAI;gBACjB,GAAG,EAAE,MAAM,CAAC,GAAU;aACvB;QACH;IAEA,IAAA,MAAM,MAAM,GAAW;IACrB,QAAA,IAAI,EAAE,QAAQ;SACf;IAED,IAAA,IAAI,IAAI,KAAK,WAAW,EAAE;IACxB,QAAA,MAAM,CAAC,SAAS,GAAG,gBAEjB,IAAY,EACZ,EAAU,EAAA;IAEV,YAAA,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE;IACf,gBAAA,OAAO,IAAI;gBACb;IACA,YAAA,OAAO,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC;IAC/B,QAAA,CAAC;QACH;aAAO;YACL,MAAM,CAAC,WAAW,GAAG,gBACnB,IAAY,EACZ,KAAoB,EACpB,aAAsC,EAAA;gBAEtC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE;IAC3B,gBAAA,OAAO,IAAI;gBACb;gBACA,OAAO,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,aAAa,CAAC,SAAS,CAAC;IACpD,QAAA,CAAC;QACH;IAEA,IAAA,OAAO,MAAM;IACf;;;;;;;;;;;"}